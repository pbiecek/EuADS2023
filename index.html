<!DOCTYPE html>
<html lang="en"><head>
<script src="EuADS_files/libs/clipboard/clipboard.min.js"></script>
<script src="EuADS_files/libs/quarto-html/tabby.min.js"></script>
<script src="EuADS_files/libs/quarto-html/popper.min.js"></script>
<script src="EuADS_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="EuADS_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EuADS_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="EuADS_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.2.313">

  <meta name="author" content="Przemyslaw Biecek">
  <title>Explanation is a process</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="EuADS_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="EuADS_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="EuADS_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="EuADS_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="EuADS_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="EuADS_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="EuADS_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="EuADS_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="EuADS_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Explanation is a process</h1>
  <p class="subtitle">a hands-on tutorial on the Interactive Explanatory Model Analysis with examples for classification models</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Przemyslaw Biecek 
</div>
</div>
</div>

  <p class="date">8/6/23</p>
</section>
<section class="slide level2">

<div class="cell">
<style type="text/css">
.reveal {
  font-size: 24px;
  line-height: 1.6!important;
}
code {
  font-size: 18px!important;
  line-height: 1.2!important;
}
pre {
  line-height: 1.2!important;
}
</style>
</div>

<img data-src="figures/eudas.png" class="r-stretch"></section>
<section>
<section id="when-why-what-how-who" class="title-slide slide level1 center">
<h1>When? Why? What? How? Who?</h1>

</section>
<section id="when---agenda" class="slide level2">
<h2>When? - Agenda</h2>
<p>Feel free to interrupt me and ask questions during the workshop!</p>
<ul>
<li><p>2:30 Introduction to the process</p></li>
<li><p>2:45 Let’s meet some models</p></li>
<li><p>3:00 Global XAI - Variable Importance + Partial Dependence Profile</p></li>
<li><p>3:30 <strong>Do it yourself !!!</strong></p></li>
<li><p><em>4:00 BREAK</em></p></li>
<li><p>4:30 Local XAI - Break-down + SHAP + Ceteris Paribus</p></li>
<li><p>5:00 Interactive EMA</p></li>
<li><p>5:20 <strong>Do it yourself !!!</strong></p></li>
<li><p>5:50 Closing remarks</p></li>
</ul>
</section>
<section id="why-should-i-care-13" class="slide level2">
<h2>Why should I care? 1/3</h2>

<img data-src="figures/XAI_13.png" class="r-stretch"></section>
<section id="why-should-i-care-23" class="slide level2">
<h2>Why should I care? 2/3</h2>

<img data-src="figures/XAI_12.png" class="r-stretch"></section>
<section id="why-should-i-care-33" class="slide level2">
<h2>Why should I care? 3/3</h2>

<img data-src="figures/incidentdatabase.png" class="r-stretch"><p>Source: <a href="https://incidentdatabase.ai/">https://incidentdatabase.ai/</a></p>
</section>
<section id="what-12" class="slide level2">
<h2>What? 1/2</h2>
<p><strong>IrResponsible Machine Learning:</strong></p>
<ol type="1">
<li>Select a problem.</li>
<li>Optimize the predictive performance of a model on the test set.</li>
<li>Don’t test anything else.</li>
<li>Jump to another problem.</li>
</ol>
<p><strong>Responsible Machine Learning:</strong></p>
<ol type="1">
<li>Select a problem.</li>
<li>Optimize the predictive performance of a model on the test set.</li>
<li>Verify that the model has not accidentally learned artifacts present in the data.</li>
<li>Verify that it is consistent with domain knowledge.</li>
<li>Monitor the model, because the future is usually different from the training data.</li>
</ol>
<p>The purpose of this tutorial is to <strong>present techniques for model exploration, visualisation and explanation</strong>. To do this we will use some interesting real-world data, train a few models on the data and then use <strong>XAI</strong> (eXplainable artificial intelligence) techniques to explore these models.</p>
</section>
<section id="what-22" class="slide level2">
<h2>What? 2/2</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><strong>Materials for our workshop</strong></p>
<ul>
<li>Explanatory Model Analysis. Explore, Explain, and Examine Predictive Models. With examples in R and Python. <a href="https://ema.drwhy.ai/">https://ema.drwhy.ai/</a></li>
<li>The Hitchhiker’s Guide to Responsible Machine Learning. Shorter summary of EMA book. <a href="https://rml.mi2.ai/">https://rml.mi2.ai/</a></li>
<li>The grammar of interactive explanatory model analysis. <a href="https://doi.org/10.1007/s10618-023-00924-w">Data Mining and Knowledge Discovery</a>. <a href="https://iema.drwhy.ai/">https://iema.drwhy.ai/</a></li>
</ul>
</div><div class="column" style="width:40%;">
<p><img data-src="figures/rml_eng.png"></p>
</div>
</div>
</section>
<section id="how---design-principles" class="slide level2">
<h2>How? - Design Principles</h2>
<ul>
<li><p>The workshop consists of 1/3 lecture, 1/3 code examples discussed by the tutor and 1/3 computer-based exercises for participants.</p></li>
<li><p>It aims to present a set of methods for the exploration of complex predictive models. I assume that participants are familiar with Python and have some basic knowledge of predictive models. In this workshop, we will show how to explore these models.</p></li>
<li><p>Feel free to interrupt me and ask questions during the workshop!</p></li>
<li><p>To make working with models more enjoyable, the materials are based on a true story, which we will tell with the help of a comic strips.</p></li>
</ul>
<p><em>The problem</em></p>
<p>The life cycle of a predictive model begins with a well-defined problem. <strong>In this example, we are looking for a model that assesses the risk of death after being diagnosed covid.</strong> We don’t want to guess who will survive and who won’t. We want to construct a score that allows us to sort patients by risk of death.</p>
<p>Why do we need such a model? It could have many applications! Those at higher risk of death could be given more protection, such as providing them with pulse oximeters or preferentially vaccinating them.</p>
</section>
<section class="slide level2">


<img data-src="figures/rml_comic_01.png" class="r-stretch"></section>
<section id="who---lets-get-to-know-each-other-12" class="slide level2">
<h2>Who? - Let’s get to know each other! 1/2</h2>
<div class="columns">
<div class="column" style="width:67%;">
<p><strong>Przemysław Biecek</strong></p>
<ul>
<li>works at <em>Faculty of Mathematics, Informatics, and Mechanics</em> at University of Warsaw and <em>Faculty of Mathematics and Information Science</em> at Warsaw University of Technology, Poland</li>
<li>for 20 years worked with teams of physicians helping them analyze data and build predictive models (often very simple)</li>
<li>research interests include <strong>Responsible Machine Learning</strong> and eXplainable Artificial Intelligence</li>
<li>(also) worked in R&amp;D teams at large and small corporations such as Samsung, IBM, Netezza, Disney, iQuor</li>
<li>leads the work of the MI2.AI research team, which carries out XAI related research projects (<strong>looking for collaborators</strong>)</li>
</ul>
</div><div class="column" style="width:33%;">
<p><img data-src="figures/przemek8.png"></p>
</div>
</div>
</section>
<section id="who---lets-get-to-know-each-other-22" class="slide level2">
<h2>Who? - Let’s get to know each other! 2/2</h2>

<img data-src="figures/menti.png" class="r-stretch"><div class="cell">
<style type="text/css">
.reveal {
  font-size: 24px;
  line-height: 1.6!important;
}
code {
  font-size: 18px!important;
  line-height: 1.2!important;
}
pre {
  line-height: 1.2!important;
}
</style>
</div>
</section></section>
<section>
<section id="introduction-to-predictive-modelling-eda" class="title-slide slide level1 center">
<h1>Introduction to predictive modelling + EDA</h1>

</section>
<section id="model-development-process-12" class="slide level2">
<h2>Model Development Process 1/2</h2>
<p>The model development is an iterative process. In each iteration, new versions of the model are created and then the models are evaluated, conclusions are drawn so as to move to the next iteration.</p>

<img data-src="figures/MDP_washmachine.png" class="r-stretch"></section>
<section id="model-development-process-22" class="slide level2">
<h2>Model Development Process 2/2</h2>
<p>Over time, the amount of resources spent on each step changes. In successive iterations, the validation of models becomes more important and exploring the data becomes less important.</p>

<img data-src="figures/mdp_general.png" class="r-stretch"></section>
<section id="model-development-process-in-10-steps" class="slide level2">
<h2>Model Development Process in 10 steps</h2>
<p>In this workshop we will go through the process of building a model in ten steps. We will build several candidate models so that they can be compared later using XAI techniques.</p>

<img data-src="figures/RML_process.png" class="r-stretch"></section></section>
<section>
<section id="step-0.-hello-model" class="title-slide slide level1 center">
<h1>Step 0. Hello model!</h1>

</section>
<section id="sars-cov-2-case-study" class="slide level2">
<h2>SARS-COV-2 case study</h2>
<p>To demonstrate what responsible predictive modelling looks like, we used data obtained in collaboration with the Polish Institute of Hygiene in modelling mortality after the Covid infection. We realize that data on Coronavirus disease can evoke negative feelings. However, it is a good example of how predictive modelling can directly impact our society and how data analysis allows us to deal with complex, important and topical problems.</p>
<p>All the results presented in this book can be independently reproduced using the snippets and instructions presented in this book. If you do not want to retype them, then all the examples, data, and codes can be found on the <a href="https://betaandbit.github.io/RML2/">https://betaandbit.github.io/RML2/</a>.</p>
<p>Our first model will be based on the statistics collected by the <a href="https://www.cdc.gov/">Centers for Disease Control and Prevention (CDC)</a>.</p>

<img data-src="figures/cdc_stats.png" class="r-stretch quarto-figure-center"><p class="caption">Figure&nbsp;1: Mortality statistics as presented on the CDC website accessed on May 2021. This table shows rate ratios compared to the group 5- to 17-year-olds (selected as the reference group because it has accounted for the largest cumulative number of COVID-19 cases compared to other age groups).</p></section>
<section id="python-snippets" class="slide level2">
<h2>Python snippets</h2>
<p>In this book we follow the convention that a model is an object that has <code>predict</code> function, which transforms the <span class="math inline">\(n\times p\)</span> input matrix with <span class="math inline">\(p\)</span> variables for <span class="math inline">\(n\)</span> observations into a vector of <span class="math inline">\(n\)</span> predictions. Below, we define a class <code>cdc_risk</code> that calculates odds of Covid related death based on statistics from the CDC website.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">class</span> cdc_risk:</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, base_risk <span class="op">=</span> <span class="fl">0.00003</span>):</span>
<span id="cb1-6"><a href="#cb1-6"></a>        <span class="va">self</span>.base_risk <span class="op">=</span> base_risk</span>
<span id="cb1-7"><a href="#cb1-7"></a>        </span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, x):</span>
<span id="cb1-9"><a href="#cb1-9"></a>        rratio <span class="op">=</span> np.array([<span class="dv">7900</span>] <span class="op">*</span> x.shape[<span class="dv">0</span>])</span>
<span id="cb1-10"><a href="#cb1-10"></a>        rratio[x.Age <span class="op">&lt;</span> <span class="fl">84.5</span>] <span class="op">=</span> <span class="dv">2800</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>        rratio[x.Age <span class="op">&lt;</span> <span class="fl">74.5</span>] <span class="op">=</span> <span class="dv">1100</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>        rratio[x.Age <span class="op">&lt;</span> <span class="fl">64.5</span>] <span class="op">=</span> <span class="dv">400</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>        rratio[x.Age <span class="op">&lt;</span> <span class="fl">49.5</span>] <span class="op">=</span> <span class="dv">130</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>        rratio[x.Age <span class="op">&lt;</span> <span class="fl">39.5</span>] <span class="op">=</span> <span class="dv">45</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>        rratio[x.Age <span class="op">&lt;</span> <span class="fl">29.5</span>] <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>        rratio[x.Age <span class="op">&lt;</span> <span class="fl">17.5</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>        rratio[x.Age <span class="op">&lt;</span> <span class="fl">4.5</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>        <span class="cf">return</span> rratio <span class="op">*</span> <span class="va">self</span>.base_risk</span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a>model_cdc <span class="op">=</span> cdc_risk()</span>
<span id="cb1-21"><a href="#cb1-21"></a>steve <span class="op">=</span> pd.DataFrame({<span class="st">"Age"</span>: [<span class="dv">25</span>], <span class="st">"Diabetes"</span>: [<span class="st">"Yes"</span>]})</span>
<span id="cb1-22"><a href="#cb1-22"></a>model_cdc.predict(steve)</span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">## array([0.00045])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Predictive models may have different structures. To work responsibly with a large number of models, a uniform standardized interface is needed. In this book, we use the abstraction implemented in the <code>dalex</code> package.</p>
<p>The <code>Explainer</code> constructor from this package creates an <em>Explainer</em>, i.e.&nbsp;a wrapper for the model that will allow you to work uniformly with objects of very different structures. The first argument is a model. It can be an object of any class but it is assumed that the objects contains the <code>predict</code> function as in our example. The <em>label</em> specifies a unique name that appear in the plots while other arguments will be introduced in next sections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">import</span> dalex <span class="im">as</span> dx</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>explainer_cdc <span class="op">=</span> dx.Explainer(model_cdc, label<span class="op">=</span><span class="st">"CDC"</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>explainer_cdc.predict(steve)</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">## array([0.00045])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the <code>Explainer</code> may seem like an unnecessary complication at the moment, but on the following pages, we show how it simplifies the work.</p>
</section></section>
<section>
<section id="step-1.-data-exploration-eda" class="title-slide slide level1 center">
<h1>Step 1. Data Exploration (EDA)</h1>

</section>
<section id="to-build-a-model-we-need-good-data." class="slide level2">
<h2>To build a model, we need good data.</h2>
<p>In Machine Learning, the word <em>good</em> means a large amount of representative data. Unfortunately, collecting representative data is neither easy nor cheap and often requires designing and conducting a specific experiment.</p>
<p>Here we use the data collected through epidemiological interviews. The number of interviewed patients is large, so we treat this data as representative, although unfortunately, this data only involves symptomatic patients who are tested positive for SARS-COV-2. Asymptomatic cases are more likely to be young adults.</p>
<p>The data is divided into two sets: <code>covid_spring</code> and <code>covid_summer</code>. The first set was acquired in spring 2020 and will be used as training data, while the second dataset was acquired in the summer and will be used for validation. In machine learning, model validation is performed on a separate data set called validation data. This controls the risk of overfitting an elastic model to the training data. If we do not have a separate set, then it is generated using cross-validation, out-of-sample, out-of-time or similar data splitting techniques.</p>
</section>
<section id="python-snippet" class="slide level2">
<h2>Python snippet</h2>
<p>All files needed to replicate the following code are available at website <a href="https://github.com/BetaAndBit/RML2">https://github.com/BetaAndBit/RML2</a>. Download <code>csv</code> file with data and save them the working directory. Let’s start our analyses with reading data from these files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>covid_spring <span class="op">=</span> pd.read_csv(<span class="st">"py_covid_spring.csv"</span>, delimiter<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>covid_summer <span class="op">=</span> pd.read_csv(<span class="st">"py_covid_summer.csv"</span>, delimiter<span class="op">=</span><span class="st">";"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s use the package <code>matplotlib</code> to draw a simple histogram for <code>Age</code> variable, and <code>statsmodels</code> to draw a mosaic plot for <code>Diabetes</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-2"><a href="#cb4-2"></a>covid_spring.pivot(columns<span class="op">=</span><span class="st">"Death"</span>, values<span class="op">=</span><span class="st">"Age"</span>).plot.hist(bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>plt.show()</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="im">from</span> statsmodels.graphics.mosaicplot <span class="im">import</span> mosaic</span>
<span id="cb4-6"><a href="#cb4-6"></a>mosaic(covid_spring, [<span class="st">'Death'</span>, <span class="st">'Diabetes'</span>])</span>
<span id="cb4-7"><a href="#cb4-7"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-02_py_mosaic" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/02_py_mosaic.png"></p>
<p></p><figcaption>Figure&nbsp;2: Left panel: Histogram for the Age variable by survivor status. Right panel: The mosaic plot shows that there are significantly fewer people with diabetes, but among them the mortality is higher.</figcaption><p></p>
</figure>
</div>
<p>A handy way to summarise tabular data in groups is the so-called <em>,,Table 1’’</em>. This is a summary of the main characteristics of each variable broken down into groups defined by the variable of interest (here, binary information about Covid death). The name stems from the fact that this summary of the data is usually the first table to be shown in many medical and related scientific journals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="im">from</span> tableone <span class="im">import</span> TableOne</span>
<span id="cb5-2"><a href="#cb5-2"></a>columns <span class="op">=</span> [<span class="st">'Gender'</span>, <span class="st">'Age'</span>, <span class="st">'Cardiovascular.Diseases'</span>, <span class="st">'Diabetes'</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>           <span class="st">'Neurological.Diseases'</span>, <span class="st">'Kidney.Diseases'</span>, <span class="st">'Cancer'</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>           <span class="st">'Hospitalization'</span>, <span class="st">'Fever'</span>, <span class="st">'Cough'</span>, <span class="st">'Death'</span>]</span>
<span id="cb5-5"><a href="#cb5-5"></a>categorical <span class="op">=</span> [<span class="st">'Gender'</span>, <span class="st">'Cardiovascular.Diseases'</span>, <span class="st">'Diabetes'</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>               <span class="st">'Neurological.Diseases'</span>, <span class="st">'Kidney.Diseases'</span>, <span class="st">'Cancer'</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>               <span class="st">'Hospitalization'</span>, <span class="st">'Fever'</span>, <span class="st">'Cough'</span>]</span>
<span id="cb5-8"><a href="#cb5-8"></a>groupby <span class="op">=</span> [<span class="st">'Death'</span>]</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a>TableOne(covid_spring, columns<span class="op">=</span>columns, </span>
<span id="cb5-11"><a href="#cb5-11"></a>        categorical<span class="op">=</span>categorical, groupby<span class="op">=</span>groupby, limit<span class="op">=</span><span class="dv">1</span>)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/py_table_one.png"></p>
<p></p><figcaption>TabelOne that summarises analysed data</figcaption><p></p>
</figure>
</div>
<p>One of the most important rules to remember when building a predictive model is: <strong>Do not condition on future!</strong>. I.e. do not use variables that are not defined at the time the prediction needs to be made. Note that in the discussed case variables <code>Hospitalization</code>, <code>Fever</code> or <code>Cough</code> are not good predictors because they are not known in advance before infection. In the following lines, we remove invalid variables from both data sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>selected_vars <span class="op">=</span> [<span class="st">'Gender'</span>, <span class="st">'Age'</span>, <span class="st">'Cardiovascular.Diseases'</span>, </span>
<span id="cb6-2"><a href="#cb6-2"></a>        <span class="st">'Diabetes'</span>, <span class="st">'Neurological.Diseases'</span>, <span class="st">'Kidney.Diseases'</span>, </span>
<span id="cb6-3"><a href="#cb6-3"></a>        <span class="st">'Cancer'</span>, <span class="st">'Death'</span>] </span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># use only selected variables</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>covid_spring <span class="op">=</span> covid_spring.loc[:, selected_vars]</span>
<span id="cb6-6"><a href="#cb6-6"></a>covid_summer <span class="op">=</span> covid_summer.loc[:, selected_vars]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data exploration and cleansing often consume most of the time spent on data analysis. Here we have only touched on exploration, but even this initial analysis helped to determine that <code>Age</code> is an important characteristic (we will confirm this later). We will build further models only on variables from the <code>selected_vars</code> vector.</p>
</section></section>
<section>
<section id="step-2.-model-performance" class="title-slide slide level1 center">
<h1>Step 2. Model Performance</h1>

</section>
<section id="measures" class="slide level2">
<h2>Measures</h2>
<p>Note that in the Covid-mortality-risk-assessment problem, we are not interested in the binary prediction survived/dead, but rather in the quality of the ranking of risk scores. Relative risks can be used to do a triage, to determine which people need a response most quickly, such as a vaccine.</p>
<div id="fig-performance_02.png" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/performance_02.png"></p>
<p></p><figcaption>Figure&nbsp;3: Classical measures of performance for classification tasks - from Wikipedia</figcaption><p></p>
</figure>
</div>
<p>For such types of problems, instead of a contingency table, one looks at Receiver Operating Characteristic (ROC) curve, which illustrates the trade-off between the true positive rate (sensitivity) and the false positive rate (1-specificity) at different classification thresholds. The curve’s shape and the area under it (AUC-ROC) provide insights into the classifier’s discrimination ability and overall predictive accuracy.</p>
<div id="fig-roc_cdc" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/02_roc_cdc.png"></p>
<p></p><figcaption>Figure&nbsp;4: Distribution of scores for the Covid model and the corresponsind ROC curve</figcaption><p></p>
</figure>
</div>
</section>
<section id="python-snippets-1" class="slide level2">
<h2>Python snippets</h2>
<p>There are many measures for evaluating predictive models, and they are implemented in <code>sklearn.metrics</code> Python module. Below we will show the most common measures calculated by default by the <code>dalex</code> package.</p>
<p>First, we need an explainer with specified validation data (here <code>covid_summer</code>) and the corresponding response variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>explainer_cdc <span class="op">=</span> dx.Explainer(</span>
<span id="cb7-2"><a href="#cb7-2"></a>    model <span class="op">=</span> model_cdc, </span>
<span id="cb7-3"><a href="#cb7-3"></a>    data  <span class="op">=</span> covid_summer.drop(<span class="st">"Death"</span>, axis<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb7-4"><a href="#cb7-4"></a>    y     <span class="op">=</span> covid_summer.Death, </span>
<span id="cb7-5"><a href="#cb7-5"></a>    model_type <span class="op">=</span> <span class="st">"classification"</span>,</span>
<span id="cb7-6"><a href="#cb7-6"></a>    label  <span class="op">=</span> <span class="st">"cdc"</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Model exploration starts with an assessment of how good is the model. The <code>model_performance()</code> function calculates a set of measures for a specified type of task, here classification.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>performance_cdc <span class="op">=</span> explainer_cdc.model_performance(cutoff<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>performance_cdc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img width="80%" src="figures/py_performance_cdc.png"></p>
<p><em>Note</em>: The explainer knows whether the model is trained for classification or regression task, so it automatically selects the right performance measures. This can be overridden if needed.</p>
<p>The <code>plot</code> function draws a graphical summary of the model performance. With the <code>geom</code> argument, one can determine the type of chart.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>performance_cdc.plot(geom <span class="op">=</span> <span class="st">"roc"</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>performance_cdc.plot(geom <span class="op">=</span> <span class="st">"lift"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-02_py_mp_roc" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/02_py_mp_roc.png"></p>
<p></p><figcaption>Figure&nbsp;5: Left panel: ROC curve. Right panel: LIFT curve, one of the many graphical statistics used in summarizing the quality of scores, often used in credit risk scoring. The OX axis presents the fraction of assigned credits, and the OY axis presents the ratio of the Sensitivity of the tested model to the Sensitivity of the random model.</figcaption><p></p>
</figure>
</div>
</section></section>
<section>
<section id="step-3.-grow-a-tree" class="title-slide slide level1 center">
<h1>Step 3. Grow a tree</h1>

</section>
<section id="classification-and-regression-trees" class="slide level2">
<h2>Classification And Regression Trees</h2>
<p>There are hundreds of different methods for training machine learning models available to experienced data scientists. One of the oldest and most popular are tree-based algorithms, first introduced in the book <em>Classification And Regression Trees</em> and commonly called CART. Here is the general deescription for this class of algorithms.</p>
<ol type="1">
<li>Start with a single node (root) with a full dataset.</li>
<li>For a current node, find a candidate split for the data in this node. To do this, consider every possible variable, and for each variable, consider every possible cutoff (for a continuous variable) or a subset of levels (for a categorical variable). Select the split that maximizes the measure of separation (see below).</li>
<li>Check a stopping criteria like the minimum gain in node purity or depth of a tree. If the stopping criteria are met, then (obviously) stop. Otherwise, partition the current node into two child nodes and go to step 2 for each child node separately.</li>
</ol>
</section>
<section id="python-snippets-2" class="slide level2">
<h2>Python snippets</h2>
<p>The most common way to train a decision tree in Python is by using the <code>DecisionTreeClassifier</code> class from <code>sklearn.tree</code> module. Scikit-learn provides a robust and user-friendly implementation of decision tree algorithms. The training process typically involves two steps: (1) create an instance of the decision tree classifier specifying any desired hyperparameters like tree’s depth, splitting criteria, and other aspects of the learning process, (2) train the decision tree model to the training data using the <code>fit</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>model_dtc <span class="op">=</span> tree.DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb10-4"><a href="#cb10-4"></a>        ccp_alpha<span class="op">=</span><span class="fl">0.0001</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a>model_dtc.fit(covid_spring.drop(<span class="st">"Death"</span>, axis<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb10-6"><a href="#cb10-6"></a>        covid_spring.Death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Trained model can be plotted with the <code>plot_tree</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">7</span>))</span>
<span id="cb11-2"><a href="#cb11-2"></a>_ <span class="op">=</span> tree.plot_tree(</span>
<span id="cb11-3"><a href="#cb11-3"></a>    model_dtc, </span>
<span id="cb11-4"><a href="#cb11-4"></a>    feature_names<span class="op">=</span>covid_spring.columns</span>
<span id="cb11-5"><a href="#cb11-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-big_tree" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/03_fig_big_tree.png"></p>
<p></p><figcaption>Figure&nbsp;6: The first split in the tree is for the Age variable. Patients are divided into younger than 67 (left) and older than 67 (right). In the same manner, one can read other splits. The criteria adopted resulted in a tree with seven leaves. The leaves include information about the number of patients who reached that leaf and the proportion of each class.</figcaption><p></p>
</figure>
</div>
<p>In order to use <code>dalex</code> pipeline we need to turn the model into the Explainer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>explainer_dtc <span class="op">=</span> dx.Explainer(</span>
<span id="cb12-2"><a href="#cb12-2"></a>    model<span class="op">=</span>model_dtc,</span>
<span id="cb12-3"><a href="#cb12-3"></a>    data<span class="op">=</span>covid_summer.drop(<span class="st">"Death"</span>, axis<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb12-4"><a href="#cb12-4"></a>    y<span class="op">=</span>covid_summer.Death, </span>
<span id="cb12-5"><a href="#cb12-5"></a>    label<span class="op">=</span><span class="st">'dtc'</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, we can calculate the performance of the model with the method <code>model_performance</code>. Here on the test data the performance is lower than for the previous model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>performance_cdc <span class="op">=</span> explainer_dtc.model_performance(cutoff <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a>performance_cdc.result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img width="80%" src="figures/py_performance_cdt.png"></p>
<p>Let’s add the AUC curve for the decision tree, to the curve obtained from the previous model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>performance_cdc.plot(performance_dtc, geom<span class="op">=</span><span class="st">"roc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-03_py_roc_tree" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/03_py_roc_tree.png"></p>
<p></p><figcaption>Figure&nbsp;7: ROC curves for the CDC and tree model.</figcaption><p></p>
</figure>
</div>
</section></section>
<section>
<section id="step-4.-plant-a-forest" class="title-slide slide level1 center">
<h1>Step 4. Plant a forest</h1>

</section>
<section id="random-forest" class="slide level2">
<h2>Random forest</h2>
<p>In 2001, Leo Breiman proposed a new family of models, called random forests, which aggregate decisions from an ensemble of trees trained on bootstrap samples.</p>
<p>Random forests combine two interesting concepts. First, combining multiple weaker models produces a stronger and more stable model. Second, the more diverse the individual models, the greater the benefit of averaging them. To increase the diversity of models, Breiman used the bootstrap technique. Bootstrap is today a very widespread and powerful statistical procedure.</p>

<img data-src="figures/04_randomForest.png" class="r-stretch quarto-figure-center"><p class="caption">Figure&nbsp;8: The key steps are: to generate a set of B bootstrap copies of the dataset by sampling rows with replacement. Deep trees are trained for each copy. During the prediction, the results of the individual trees are aggregated.</p></section>
<section id="python-snippets-3" class="slide level2">
<h2>Python snippets</h2>
<p>The most common way to train a decision tree in Python is by using the <code>RandomForestClassifier</code> class from <code>sklearn.ensemble</code> module. Scikit-learn provides a straightforward implementation of Random Forest algorithms. As with other Scikit-learn models the training process typically involves two steps: (1) create an instance of the classifier specifying any desired hyperparameters like number of trees, (2) train the model to the training data using the <code>fit</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>model_rfc <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a>model_rfc.fit(covid_spring.drop(<span class="st">'Death'</span>, axis<span class="op">=</span><span class="dv">1</span>), covid_spring.Death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A trained model can be turned into a <code>dalex</code> explainer. Note that we set the <code>label</code> argument to control name of the model presented in diagnostic plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>explainer_rfc <span class="op">=</span> dx.Explainer(</span>
<span id="cb16-2"><a href="#cb16-2"></a>    model<span class="op">=</span>model_rfc,</span>
<span id="cb16-3"><a href="#cb16-3"></a>    data<span class="op">=</span>covid_summer.drop(<span class="st">'Death'</span>, axis<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb16-4"><a href="#cb16-4"></a>    y<span class="op">=</span>covid_summer.Death,</span>
<span id="cb16-5"><a href="#cb16-5"></a>    label<span class="op">=</span><span class="st">'rfc'</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now check how good this model is. As expected, a random forest model has better performance/AUC than a single tree.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>performance_rfc <span class="op">=</span> explainer_rfc.model_performance(</span>
<span id="cb17-2"><a href="#cb17-2"></a>        model_type<span class="op">=</span><span class="st">"classification"</span>, cutoff<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>performance_rfc.result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img width="80%" src="figures/py_performance_crf.png"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>performance_cdc.plot([performance_rfc, performance_dtc], </span>
<span id="cb18-2"><a href="#cb18-2"></a>        geom<span class="op">=</span><span class="st">"roc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-04_py_roc_forest" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/04_py_roc_forest.png"></p>
<p></p><figcaption>Figure&nbsp;9: ROC curves for the CDC, tree and ranger model.</figcaption><p></p>
</figure>
</div>
</section></section>
<section>
<section id="step-5.-hyperparameter-optimisation" class="title-slide slide level1 center">
<h1>Step 5. Hyperparameter Optimisation</h1>

</section>
<section id="tuning" class="slide level2">
<h2>Tuning</h2>
<p>Machine Learning algorithms typically have many hyperparameters that specify a model training process. For some model families, like Support Vector Machines (SVM) or Gradient Boosting Machines (GBM), the selection of such hyperparameters has a strong impact on the performance of the final model. The process of finding good hyperparameters is commonly called <em>tuning</em>.</p>
<p>Different model families have different sets of hyperparameters. We don’t always want to optimize all of them simultaneously, so the first step is to define the hyperparameter search space. Once it is specified, then tuning is based on a looped two steps: (1) select a set of hyperparameters and (2) evaluate how good this set of hyperparameters is. These steps are repeated until some stopping criterion is met, such as the maximum number of iterations, desired minimum model performance, or some increase in model performance.</p>

<img data-src="figures/05_mlr3tuning.png" class="r-stretch quarto-figure-center"><p class="caption">Figure&nbsp;10: The hyperparameter optimization scheme implemented in the mlr3tuning package. Source: https://mlr3book.mlr-org.com/tuning.html</p></section>
<section id="python-snippets-4" class="slide level2">
<h2>Python snippets</h2>
<p>The most common way to perform a hyperparameter optimisation in Python is by using the <code>RandomizedSearchCV</code> class from module <code>sklearn.model_selection</code>.</p>
<p>First, we need to specify the space of hyperparameters to search. Not all hyperparameters are worth optimizing. Let’s focus on three for the random forest algorithm: number of trees, max depth of a tree and the spliting critera.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="im">import</span> scipy</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span>
<span id="cb19-3"><a href="#cb19-3"></a>search_space <span class="op">=</span> {</span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="st">'n_estimators'</span>: scipy.stats.randint(<span class="dv">50</span>,  <span class="dv">500</span>),</span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="st">'max_depth'</span>   : scipy.stats.randint(<span class="dv">1</span>,  <span class="dv">10</span>),</span>
<span id="cb19-6"><a href="#cb19-6"></a>    <span class="st">'criterion'</span>   : [<span class="st">"gini"</span>, <span class="st">"entropy"</span>]</span>
<span id="cb19-7"><a href="#cb19-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For automatic hyperparameter search, it is necessary to specify: (1) search strategy (below it is the random search), (2) family of models to be tested, (3) definition of space for hyperparameters, (4) a procedure to evaluate the performance of the proposed models (below it is the AUC determined by 5-fold cross-validation), (5) a stopping criterion (below it is 10 evaluations).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>model_rfc_tuned <span class="op">=</span> RandomizedSearchCV(</span>
<span id="cb20-2"><a href="#cb20-2"></a>    estimator<span class="op">=</span>RandomForestClassifier(random_state<span class="op">=</span><span class="dv">0</span>), </span>
<span id="cb20-3"><a href="#cb20-3"></a>    param_distributions<span class="op">=</span>search_space, </span>
<span id="cb20-4"><a href="#cb20-4"></a>    scoring<span class="op">=</span><span class="st">"roc_auc"</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>    cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb20-6"><a href="#cb20-6"></a>    n_iter<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb20-7"><a href="#cb20-7"></a>    refit<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb20-8"><a href="#cb20-8"></a>    random_state<span class="op">=</span><span class="dv">0</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we are ready to fit parameters in this pipeline. As usual in can be done with <code>fit()</code> method. After the tuning the best identified hyperparameters cna be extracted from the <code>best_params_</code> field.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>model_rfc_tuned.fit(covid_spring.drop(<span class="st">'Death'</span>, axis<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb21-2"><a href="#cb21-2"></a>        covid_spring.Death)</span>
<span id="cb21-3"><a href="#cb21-3"></a>model_rfc_tuned.best_params_</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># {'criterion': 'gini', 'max_depth': 6, 'n_estimators': 242}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is, of course, no guarantee that the tuner will find better hyperparameters than the default ones. But in this example, the tuned model is better than all other models that we have considered so far. Let’s see how much. We need a <code>dalex</code> wrapper.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>explainer_rfc_tuned <span class="op">=</span> dx.Explainer(</span>
<span id="cb22-2"><a href="#cb22-2"></a>    model<span class="op">=</span>model_rfc_tuned,</span>
<span id="cb22-3"><a href="#cb22-3"></a>    data<span class="op">=</span>covid_summer.drop(<span class="st">'Death'</span>, axis<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb22-4"><a href="#cb22-4"></a>    y<span class="op">=</span>covid_summer.Death,</span>
<span id="cb22-5"><a href="#cb22-5"></a>    label<span class="op">=</span><span class="st">'rfc_tuned'</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can calculate and compare the model performance/AUC on validation data and then compare ROC curves for various models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>performance_rfc_tuned <span class="op">=</span> explainer_rfc_tuned.model_performance(</span>
<span id="cb23-2"><a href="#cb23-2"></a>        model_type<span class="op">=</span><span class="st">"classification"</span>, cutoff<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a>performance_rfc_tuned.result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img width="80%" src="figures/py_performance_auto.png"></p>
<p>Let’s plot all ROC curves in a single plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>performance_cdc.plot([performance_rfc, performance_dtc, </span>
<span id="cb24-2"><a href="#cb24-2"></a>        performance_rfc_tuned], geom<span class="op">=</span><span class="st">"roc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-05_py_roc_tuned" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/05_py_roc_tuned.png"></p>
<p></p><figcaption>Figure&nbsp;11: ROC curves for the CDC, tree, ranger model and auto tune ranger model.</figcaption><p></p>
</figure>
</div>
</section></section>
<section>
<section id="step-6.-variable-importance" class="title-slide slide level1 center">
<h1>Step 6. Variable-importance</h1>

</section>
<section id="do-we-need-a-new-measure-for-variable-importance" class="slide level2">
<h2>Do we need a new measure for Variable Importance?</h2>
<p>Some models have built-in methods for the assessment of Variable importance. For linear models, one can use standardized model coefficients or p-values. For random forest one can use out-of-bag classification error. For tree boosting models, one can use gain statistics.</p>
<p>From: <a href="http://www.jmlr.org/papers/volume20/18-760/18-760.pdf">http://www.jmlr.org/papers/volume20/18-760/18-760.pdf</a></p>
<p><em>Several common approaches for variable selection, or for describing relationships between variables, do not necessarily capture a variable’s importance. Null hypothesis testing methods may identify a relationship, but do <strong>not describe the relationship’s strength</strong>. Similarly, checking whether a variable is included by a sparse model-fitting algorithm, such as the Lasso (Hastie et al., 2009), <strong>does not describe the extent to which the variable is relied on.</strong> Partial dependence plots (Breiman et al., 2001; Hastie et al., 2009) <strong>can be difficult to interpret if multiple variables are of interest, or if the prediction model contains interaction effects</strong> .</em></p>
<p><em>Another common VI procedure is to run a model-fitting algorithm twice, first on all of the data, and then again after removing X1 from the data set. The losses for the <strong>two resulting models are then compared to determine the importance, or “necessity,” of X1</strong> (Gevrey et al., 2003). Because this measure is a function of two prediction models rather than one, it does not measure how much either individual model relies on X1.</em></p>
</section>
<section id="which-variables-are-important" class="slide level2">
<h2>Which variables are important?</h2>
<p>Some models have built-in methods for the assessment of variable importance. For example, for linear models, one can use standardized model coefficients or p-values. For the random forest, one can use out-of-bag classification error. For tree boosting models, one can use information gain statistics. Yet, the problem with such model-specific techniques is that they cannot be compared between models of different structures. For this and a few other reasons, it is convenient to use model agnostic techniques, such as permutational importance of variables.</p>
<p>The procedure is based on perturbations of a selected variable or group of variables. The intuition is that if a variable is important in a model, then after its random perturbation the model predictions should be less accurate.</p>
<p>The permutation-based variable-importance of a variable <span class="math inline">\(i\)</span> is the difference (or ratio) between the model performance for the original data and the model performance calculated on data with the permuted variable <span class="math inline">\(i\)</span>. More formally</p>
<p><span class="math display">\[
VI(i) = L(f, X^{perm(i)}, y) - L(f, X, y),
\]</span></p>
<p>where <span class="math inline">\(L(f, X, y)\)</span> is the value of loss function or performance measure for the data <span class="math inline">\(X\)</span>, true labels <span class="math inline">\(y\)</span> and model <span class="math inline">\(f\)</span>, while <span class="math inline">\(X^{perm(i)}\)</span> is dataset <span class="math inline">\(x\)</span> with <span class="math inline">\(i\)</span>-th variable permuted.</p>
</section>
<section id="python-snippets-5" class="slide level2">
<h2>Python snippets</h2>
<p>We use the <code>model_parts</code> method from the <code>dalex</code> package to calculate the importance of variables. The only required argument is the model to be analyzed. With additional arguments, one can also specify how the importance of variables is to be calculated, whether as a difference, ratio or without normalization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>importance_rfc <span class="op">=</span> explainer_rfc.model_parts(</span>
<span id="cb25-2"><a href="#cb25-2"></a>        loss_function<span class="op">=</span><span class="st">"1-auc"</span>, </span>
<span id="cb25-3"><a href="#cb25-3"></a>        <span class="bu">type</span><span class="op">=</span><span class="st">"difference"</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb25-4"><a href="#cb25-4"></a>importance_rfc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figures/py_vip_table.png" width="55%"></p>
<p>This technique is handy when we want to compare the importance of variables in different models. Let’s see what it looks like in our example. The <code>plot</code> method works for any number of models given as consecutive arguments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>importance_cdc <span class="op">=</span> explainer_cdc.model_parts(</span>
<span id="cb26-2"><a href="#cb26-2"></a>    loss_function<span class="op">=</span><span class="st">"1-auc"</span>, <span class="bu">type</span><span class="op">=</span><span class="st">"difference"</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>importance_dtc <span class="op">=</span> explainer_dtc.model_parts(</span>
<span id="cb26-4"><a href="#cb26-4"></a>    loss_function<span class="op">=</span><span class="st">"1-auc"</span>, <span class="bu">type</span><span class="op">=</span><span class="st">"difference"</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a>importance_rfc_tuned <span class="op">=</span> explainer_rfc_tuned.model_parts(</span>
<span id="cb26-6"><a href="#cb26-6"></a>    loss_function<span class="op">=</span><span class="st">"1-auc"</span>, <span class="bu">type</span><span class="op">=</span><span class="st">"difference"</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a>importance_cdc.plot([importance_rfc, importance_dtc, </span>
<span id="cb26-9"><a href="#cb26-9"></a>        importance_rfc_tuned], show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-py_vi_four" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/06_py_vi_four.png"></p>
<p></p><figcaption>Figure&nbsp;12: The importance of variables can be compared between various models, and it is usually a source of valuable information. In this plot, each bar starts at 1-AUC for the model on the original data and ends at 1-average AUC calculated on the data with the indicated variable permuted.</figcaption><p></p>
</figure>
</div>
<p>For the CDC model, the only important variable is Age. For the tree model, the three important variables are Age, Cancer, and Cardiovascular diseases, an observation consistent with <a href="#/fig-big_tree">Figure&nbsp;6</a>. For the ranger model and the model after tuning of hyperparameters, more variables are taken into account. However, Age is indisputably the most important variable in all models.</p>
<p>The same perturbation technique can be used to analyze the importance of groups of variables. Just use the <code>variable_groups</code> argument. Grouping variables can be particularly useful if the number of variables is large and groups of variables describe some common aspects. In our case we could group all diseases together.</p>
</section></section>
<section id="your-turn" class="title-slide slide level1 center">
<h1>Your turn</h1>
<ul>
<li>In jupiter, reproduce the results from the presentation for the <code>covid</code> data</li>
<li>Apply discussed techniques for the Titanic data (<a href="https://ema.drwhy.ai/dataSetsIntro.html#models-for-rms-titanic-snippets-for-python">see EMA</a>)</li>
</ul>
<pre><code>import dalex as dx
titanic = dx.datasets.load_titanic()
X = titanic.drop(columns='survived')
y = titanic.survived</code></pre>
</section>

<section>
<section id="introduction-to-xai" class="title-slide slide level1 center">
<h1>Introduction to XAI</h1>

</section>
<section class="slide level2">


<img data-src="figures/map_0_2_1.png" class="r-stretch"></section>
<section class="slide level2">


<img data-src="figures/DALEXpiramide%202.png" class="r-stretch"></section></section>
<section>
<section id="step-7.-partial-dependence-and-accumulated-local-effects" class="title-slide slide level1 center">
<h1>Step 7. Partial Dependence and Accumulated Local Effects</h1>

</section>
<section id="partial-dependence" class="slide level2">
<h2>Partial Dependence</h2>
<p>Once we know which variables are important, it is usually interesting to determine the relationship between a particular variable and the model prediction. Popular techniques for this type of Explanatory Model Analysis are Partial Dependence (PD) and Accumulated Local Effects (ALE).</p>
<p>PD profiles were initially proposed in 2001 for gradient boosting models but can be used in a model agnostic fashion. This method is based on analysis of average model response after replacing variable <span class="math inline">\(i\)</span> with the value of <span class="math inline">\(t\)</span>.</p>
<p>More formally, Partial Dependence profile for variable <span class="math inline">\(i\)</span> is a function of <span class="math inline">\(t\)</span> defined as</p>
<p><span class="math display">\[
PD(i, t) = E\left[ f(x_1, ..., x_{i-1}, t, x_{i+1}, ..., x_p) \right],
\]</span></p>
<p>where the expected value is calculated over the data distribution. The straightforward estimator is</p>
<p><span class="math display">\[
\widehat{PD}(i, t) = \frac 1n \sum_{j=1}^n f(x^j_1, ..., x^j_{i-1}, t, x^j_{i+1}, ..., x^j_p).
\]</span></p>
</section>
<section id="python-snippets-6" class="slide level2">
<h2>Python snippets</h2>
<p>We use the <code>model_profile</code> method from the <code>dalex</code> package to calculate the variable profile. The only required argument is the model to be analyzed. It is a good idea to specify names of variables for profile estimation as a second argument; otherwise, profiles are calculated for all variables, which can take some time. One can also specify the exact grid of values for calculations of profiles.</p>
<p>The average is calculated for the distribution specified in the <code>data</code> argument in the explainer. Here we calculate the PD profiles for the Age variable for <code>covid_summer</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>profile_rfc <span class="op">=</span> explainer_rfc.model_profile(variables<span class="op">=</span><span class="st">"Age"</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>profile_rfc.plot(show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-mpp1_ranger" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/08_mprofile_ranger.png"></p>
<p></p><figcaption>Figure&nbsp;13: Partial dependence profile for Age variable.</figcaption><p></p>
</figure>
</div>
<p>Since we have four models it is worth comparing how they differ in terms of the model’s response to the Age variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>profile_cdc <span class="op">=</span> explainer_cdc.model_profile(variables<span class="op">=</span><span class="st">"Age"</span>)</span>
<span id="cb29-2"><a href="#cb29-2"></a>profile_dtc <span class="op">=</span> explainer_dtc.model_profile(variables<span class="op">=</span><span class="st">"Age"</span>)</span>
<span id="cb29-3"><a href="#cb29-3"></a>profile_rfc_tuned <span class="op">=</span> explainer_rfc_tuned.model_profile(</span>
<span id="cb29-4"><a href="#cb29-4"></a>        variables<span class="op">=</span><span class="st">"Age"</span>)</span>
<span id="cb29-5"><a href="#cb29-5"></a></span>
<span id="cb29-6"><a href="#cb29-6"></a>profile_cdc.plot([profile_rfc, profile_dtc, </span>
<span id="cb29-7"><a href="#cb29-7"></a>        profile_rfc_tuned], show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-py_mprofile_all" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/py_mprofile_all.png"></p>
<p></p><figcaption>Figure&nbsp;14: Each colour indicates a different model. The CDC model has a shifted sharp increase in risk of death. Models based on <code>covid_spring</code> data are more likely to place the dramatic increase in the risk around age 65. The tree model is too shallow to capture the ever-increasing risk in the oldest group. Despite this, the models are quite consistent about the general shape of the relationship.</figcaption><p></p>
</figure>
</div>
</section>
<section id="grouped-partial-dependence-profiles" class="slide level2">
<h2>Grouped Partial Dependence profiles</h2>
<p>By default, the average is calculated for all observations. But with the argument one can specify a grouping variable. PD profiles are calculated independently for each level of this variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>grouped_profile_rfc_tuned <span class="op">=</span> explainer_rfc_tuned.model_profile(</span>
<span id="cb30-2"><a href="#cb30-2"></a>        variables<span class="op">=</span><span class="st">"Age"</span>, groups<span class="op">=</span><span class="st">"Diabetes"</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>grouped_profile_rfc_tuned.plot(show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="figures/py_mprofile_grouped_ranger.png" class="r-stretch quarto-figure-center"><p class="caption">Figure&nbsp;15: Partial Dependence for Age in groups defined by Diabetes variable.</p></section></section>
<section>
<section id="step-8.-shapley-values-and-the-break-down-plots" class="title-slide slide level1 center">
<h1>Step 8. Shapley values and the Break-down plots</h1>

</section>
<section id="notation" class="slide level2">
<h2>Notation</h2>
<ul>
<li>We have set of <span class="math inline">\(P = \{1, ..., p\}\)</span> players</li>
<li>For each coalition, i.e.&nbsp;subset <span class="math inline">\(S \subseteq P\)</span> we can calculate the payout <span class="math inline">\(v(S)\)</span> and <span class="math inline">\(v(\{\varnothing\}) = 0\)</span></li>
<li>We want to fairly distribute the payout <span class="math inline">\(v(P)\)</span></li>
<li>Optimal attribution for player <span class="math inline">\(i\in P\)</span> will be denoted as <span class="math inline">\(\phi_i\)</span></li>
</ul>
</section>
<section id="motivational-example-13" class="slide level2">
<h2>Motivational example 1/3</h2>
<p>How to divide the reward?</p>
<ul>
<li>Three parties A, B and C took part in the election.</li>
<li>As a result of the election, parties A and B each have 49% representation in the parliament and party C has 2% representation.</li>
<li>Let’s assume that A and C formed a government.</li>
<li>How to fairly divide the prize (ministries)?</li>
<li>What share of the prize should party C have?</li>
</ul>
<p>Note that any two parties can form a government. In that case, should the prize for C be equal to or less than that for A?</p>
<p>
<img src="figures/shap_v_01.png" width="100%">
</p>
</section>
<section id="motivational-example-23" class="slide level2">
<h2>Motivational example 2/3</h2>
<p>Students A, B and C carry out a project together. With this payoff table, determine what portion of the award each student should get.</p>
<p>
<img src="figures/shap_v_02.png" width="100%">
</p>
</section>
<section id="motivational-example-23-cont." class="slide level2">
<h2>Motivational example 2/3 cont.</h2>
<p>Students A, B and C carry out a project together. With this payoff table, determine what portion of the award each student should get.</p>
<p>
<img src="figures/shap_v_03.png" width="100%">
</p>
</section>
<section id="motivational-example-33" class="slide level2">
<h2>Motivational example 3/3</h2>
<p>Students A, B and C carry out a project together. With this payoff table, determine what portion of the award each student should get.</p>
<p>
<img src="figures/shap_v_04.png" width="100%">
</p>
</section>
<section id="motivational-example-33-cont." class="slide level2">
<h2>Motivational example 3/3 cont.</h2>
<p>Students A, B and C carry out a project together. With this payoff table, determine what portion of the award each student should get.</p>
<p>
<img src="figures/shap_v_05.png" width="100%">
</p>
</section>
<section id="required-properties-of-fair-payout" class="slide level2">
<h2>Required properties of fair payout</h2>
<p>One can define various desirable properties of fair reward distribution. The following seem to be natural (or at least they were for Lord Shapley).</p>
<ul>
<li><strong>Efficiency</strong>: all contributions sum up to the final reward</li>
</ul>
<p><span class="math display">\[
\sum_j \phi_j = v(P)
\]</span></p>
<ul>
<li><strong>Symmetry</strong>: if players <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> contributed in the same way to each coalition then they get the same reward</li>
</ul>
<p><span class="math display">\[
\forall_S v(S \cup \{i\}) = v(S \cup \{j\})     \Rightarrow \phi_i = \phi_j
\]</span></p>
<ul>
<li><strong>Dummy</strong>: if player <span class="math inline">\(i\)</span> does not contribute then its reward is <span class="math inline">\(0\)</span></li>
</ul>
<p><span class="math display">\[
\forall_S v(S \cup \{i\}) = v(S)    \Rightarrow \phi_i = 0
\]</span></p>
<ul>
<li><strong>Additivity</strong>: reward in sum of games <span class="math inline">\(v_1\)</span> and <span class="math inline">\(v_2\)</span> is sum of rewards</li>
</ul>
<p><span class="math display">\[
\forall_S v(S) = v_1(S) + v_2(S)    \Rightarrow \phi_i = \phi_{1,i} + \phi_{2,i}
\]</span></p>
</section>
<section id="shapley-values-via-permutations" class="slide level2">
<h2>Shapley values (via permutations)</h2>
<ul>
<li>Fair reward sharing strategy for player <span class="math inline">\(j\in P\)</span> will be denoted as <span class="math inline">\(\phi_j\)</span>. Surprise, these are Shapley values.</li>
<li>Note that added value of player <span class="math inline">\(j\)</span> to coalition <span class="math inline">\(S\)</span> is <span class="math inline">\(v(S \cup \{j\}) - v(S)\)</span></li>
<li>Shapley values are defined as</li>
</ul>
<p><span class="math display">\[
\phi_j = \frac{1}{|P|!} \sum_{\pi \in \Pi} (v(S_j^\pi \cup \{j\}) - v(S_j^\pi))
\]</span></p>
<p>where <span class="math inline">\(\Pi\)</span> is a set of all possible permutations of players <span class="math inline">\(P\)</span> while <span class="math inline">\(S_j^\pi\)</span> is a set of players that are before player <span class="math inline">\(j\)</span> in permutation <span class="math inline">\(\pi\)</span>.</p>
<ul>
<li>Instead of trying all <span class="math inline">\(\Pi\)</span> permutations one can use only <span class="math inline">\(B\)</span> random permutations to estimate <span class="math inline">\(\phi_j\)</span></li>
</ul>
<p><span class="math display">\[
\hat\phi_j = \frac{1}{|B|} \sum_{\pi \in B} (v(S_j^\pi \cup \{j\}) - v(S_j^\pi))
\]</span></p>
</section>
<section id="shapley-values" class="slide level2">
<h2>Shapley values</h2>
<p>For tabular data, one of the most commonly used techniques for local variable attribution is Shapley values. The key idea behind this method is to analyze the sequence of conditional expected values. This way, we can trace how the conditional mean moves from the average model response to the model prediction for observation of interest <span class="math inline">\(x^*\)</span>. Let’s consider a sequence of expected values.</p>
<p><img data-src="figures/08_equations.png"></p>
<p>By looking at consecutive differences <span class="math inline">\(\mu_{x_1}-\mu\)</span>, <span class="math inline">\(\mu_{x_1,x_2}-\mu_{x_1}\)</span> and so on, one can calculate the added effects of individual variables, see an example in <a href="#/fig-breakDown">Figure&nbsp;16</a>. It sounds like a straightforward solution; however, there are two issues with this approach.</p>
<p>One is that it is not easy to estimate the conditional expected value. In most implementations, it is assumed that features are independent, and then we can estimate <span class="math inline">\(\mu_{K}\)</span> as an average model response with variables in the set <span class="math inline">\(K\)</span> replaced by corresponding values from observation <span class="math inline">\(x^*\)</span>. So the crude estimate would be</p>
<p><span class="math display">\[
\widehat{\mu}_{K} = \frac 1n \sum_{i=1}^n f(x_1^o, x_2^o, ..., x_p^o),\text{ where }\left\{ {{x_j^o = x_j^*,\text{  if }j \in K} \atop {x_j^o = x_j^i,\text{  if }j \not\in K.} } \right.
\]</span></p>
<p>The second issue is that these effects may depend on the order of conditioning. How to solve this problem? The Shapley values method calculates attributions as an average of all (or at least a large number of random) orderings, while the Break-down method uses a single ordering determined with a greedy heuristic that prefers variables with the largest attribution at the beginning.</p>
<div id="fig-breakDown" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/distributions_ranger.png"></p>
<p></p><figcaption>Figure&nbsp;16: The following rows show the conditional distributions (vioplots) and the conditional expected value (red dot). The grey lines between the rows show how the predictions for each observation change after replacing the next variable with the value from observation <span class="math inline">\(x^*\)</span>. Analyzing such a sequence of conditionings, we can read which variables significantly explain the differences between the mean model response (the first row) and the observed model response (the last row).</figcaption><p></p>
</figure>
</div>
</section>
<section id="break-down" class="slide level2">
<h2>Break down</h2>
<p><img data-src="figures/shap_01.png"></p>
<p><img data-src="figures/shap_02.png"></p>
</section>
<section id="shap-vs-break-down" class="slide level2">
<h2>SHAP vs Break-down</h2>
<p>Consecutive conditioning may depend on the order of variables.</p>
<p><strong>The Shapley values method calculates attributions as an average of all</strong> (or at least a large number of random) orderings,</p>
<p>while the <strong>Break-down method uses a single ordering determined with a greedy heuristic that prefers variables with the largest attribution at the beginning.</strong></p>
</section>
<section id="python-snippets-7" class="slide level2">
<h2>Python snippets</h2>
<p>Let’s define an observation for which we will examine the model more closely. Let it be a 76-year-old man with hypertension. We show a local model analysis using <code>model_ranger</code> as an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>Steve <span class="op">=</span> pd.DataFrame({</span>
<span id="cb31-2"><a href="#cb31-2"></a>    <span class="st">"Gender"</span>: [<span class="dv">1</span>], </span>
<span id="cb31-3"><a href="#cb31-3"></a>    <span class="st">"Age"</span>: [<span class="dv">76</span>], </span>
<span id="cb31-4"><a href="#cb31-4"></a>    <span class="st">"Cardiovascular.Diseases"</span>: [<span class="dv">1</span>], </span>
<span id="cb31-5"><a href="#cb31-5"></a>    <span class="st">"Diabetes"</span>: [<span class="dv">0</span>],</span>
<span id="cb31-6"><a href="#cb31-6"></a>    <span class="st">"Neurological.Diseases"</span>: [<span class="dv">0</span>],</span>
<span id="cb31-7"><a href="#cb31-7"></a>    <span class="st">"Kidney.Diseases"</span>: [<span class="dv">0</span>],</span>
<span id="cb31-8"><a href="#cb31-8"></a>    <span class="st">"Cancer"</span>: [<span class="dv">0</span>]</span>
<span id="cb31-9"><a href="#cb31-9"></a>})</span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a>model_rfc_tuned.predict_proba(Steve)</span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="co"># array([[0.65611756, 0.34388244]])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>predict_parts</code> function for a specified model and a specified observation calculates local variable attributions. The optional argument <code>order</code> forces use of a specified sequence of variables. If not specified, then a greedy heuristic is used to start conditioning with the most relevant variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>breakdown_steve <span class="op">=</span> explainer_rfc_tuned.predict_parts(Steve, </span>
<span id="cb32-2"><a href="#cb32-2"></a>        <span class="bu">type</span><span class="op">=</span><span class="st">"break_down"</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb32-3"><a href="#cb32-3"></a>shap_steve <span class="op">=</span> explainer_rfc_tuned.predict_parts(Steve, </span>
<span id="cb32-4"><a href="#cb32-4"></a>        <span class="bu">type</span><span class="op">=</span><span class="st">"shap"</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a>breakdown_steve.plot(show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-py_bd_ranger" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/py_bd_ranger.png"></p>
<p></p><figcaption>Figure&nbsp;17: Break-down contributions of each variable to the final model response.</figcaption><p></p>
</figure>
</div>
<p>The alternative is to average over all (or at least many random) orderings of variables. This is how the Shapley values are calculated. The <code>show_boxplots</code> argument highlights the stability of the estimated attributions between different orderings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>shap_steve.plot(show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-py_shap_bd_ranger" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/py_shap_ranger.png"></p>
<p></p><figcaption>Figure&nbsp;18: Shapley values contributions to the final model prediction.</figcaption><p></p>
</figure>
</div>
</section>
<section id="from-local-to-global-feature-importance" class="slide level2">
<h2>From local to global – Feature importance</h2>
<ul>
<li>The SHAP method gives local explanations, i.e.&nbsp;explanations for each single observation. But we can convert them to global explanations by aggregating the explanations for individual observations.</li>
<li>For example, we can assess the validity of a variable by counting the average modulus of SHAP explanations.</li>
<li>Such a measure of the importance of variables does not depend on the model structure and can be used to compare models.</li>
<li>Below is an example for the model trained for Titanic data</li>
</ul>
<p>
<img src="figures/shap_global_3.png" width="100%">
</p>
</section>
<section id="from-local-to-global-summary-plot" class="slide level2">
<h2>From local to global – Summary plot</h2>
<ul>
<li>One of the most useful statistics is a plot summarizing the distribution of Shapley values for the data for each variable.</li>
<li>On the OX axis are presented the Shapley values, in the rows are the variables. The color indicates whether an observation had a high or low value in that variable.</li>
<li>From the graph you can read which variables are important (they have a large spread of points)</li>
<li>You can read what is the relationship between the variable and the Shapley value, whether the color has a monotonic gradation or there are some dependencies</li>
<li>You can read the distribution of Shapley values</li>
</ul>
<p>
<img src="figures/shap_global_2.png" width="100%">
</p>
</section>
<section id="from-local-to-global-dependence-plot" class="slide level2">
<h2>From local to global – Dependence plot</h2>
<ul>
<li>If we plot the Shapley values as functions of the value of the original variable, it is possible to see what kind of relationship exists between this variable and the average result.</li>
<li>This type of plots allows you to choose the transformations of the variable, and better understand the relationship between this variable and the result of the model</li>
</ul>
<p>
<img src="figures/shap_global_4.png" width="100%">
</p>
<ul>
<li>We can additionally color the graph depending on one more variable (in the example below, it is gender) to see if an interaction is present in the model. In this case, the attributes of the model will depend on the value of this additional variable.</li>
</ul>
<p>
<img src="figures/shap_global_5.png" width="100%">
</p>
</section></section>
<section>
<section id="step-9.-ceteris-paribus" class="title-slide slide level1 center">
<h1>Step 9. Ceteris Paribus</h1>

</section>
<section id="other-things-being-equal" class="slide level2">
<h2>Other things being equal</h2>
<p>Ceteris Paribus (CP) is a Latin phrase for “<em>other things being equal</em>”. It is also a very useful technique for an analysis of model behaviour for a single observation. CP profiles, sometimes called Individual Conditional Expectations (ICE), show how the model response would change for a selected observation if a value for one variable was changed while leaving the other variables unchanged.</p>
<p>While local variable attribution is a convenient technique for answering the question of <strong>which</strong> variables affect the prediction, the local profile analysis is a good technique for answering the question of <strong>how</strong> the model response depends on a particular variable. Or answering the question of <strong>what if</strong>…</p>
</section>
<section id="partial-dependence---intutition" class="slide level2">
<h2>Partial Dependence - intutition</h2>
<ul>
<li>As with other explanations, we can aggregate local explanations to get a global view of how the model works.</li>
<li>Let’s average Ceteris Paribus profiles.</li>
</ul>
<p>
</p><center>
<img src="figures/pdp_avg.png" width="80%">
</center>
<p></p>
</section>
<section id="partial-dependence-in-action-again" class="slide level2">
<h2>Partial Dependence in action (again)</h2>
<p>Once we know which variables are important, it is usually interesting to determine the relationship between a particular variable and the model prediction. Popular techniques for this type of Explanatory Model Analysis are Partial Dependence (PD) and Accumulated Local Effects (ALE).</p>
<p>Introduced in 2001 in the paper <em>Greedy Function Approximation: A Gradient Boosting Machine</em>. <a href="https://www.jstor.org/stable/2699986">Jerome Friedman. The Annals of Statistics 2001</a></p>
<p>Ceteris Paribus averaged profile following marginal distribution of variables <span class="math inline">\(X^{-j}\)</span>.</p>
<p><span class="math display">\[
PD(i, t) = E\left[ f(x_1, ..., x_{i-1}, t, x_{i+1}, ..., x_p) \right],
\]</span></p>
<p>The estimation is based on the average of the CP profiles.</p>
<p>The computational complexity is <span class="math inline">\(N \times Z\)</span> model evaluations, where <span class="math inline">\(N\)</span> is the number of observations and <span class="math inline">\(Z\)</span> is the number of points at which the CP profile is calculated (<em>how to select these points?</em>).</p>
<p><span class="math display">\[
\widehat{PD}(i, t) = \frac 1n \sum_{j=1}^n f(x^j_1, ..., x^j_{i-1}, t, x^j_{i+1}, ..., x^j_p).
\]</span></p>
<p>Replacing <span class="math inline">\(i\)</span>-th variable by value <span class="math inline">\(t\)</span> can lead to very strange observations, especially when <span class="math inline">\(i\)</span>-th variable is correlated with other variables and we ignore the correlation structure. One solution to this are Accumulated Local Effects profiles, which average over the conditional distribution.</p>
<p>ALE method was introduced in <a href="https://rss.onlinelibrary.wiley.com/doi/abs/10.1111/rssb.12377">Visualizing the effects of predictor variables in black box supervised learning models</a> by Daniel Apley and Jingyu Zhu</p>
</section>
<section id="python-snippets-8" class="slide level2">
<h2>Python snippets</h2>
<p>The <code>predict_profiles()</code> function calculates Ceteris Paribus profiles for a selected model and selected observations. By default, it calculates profiles for all variables, but one can limit this list with the <code>variables</code> vector of variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>cp_steve <span class="op">=</span> explainer_rfc_tuned.predict_profile(Steve)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The calculated profiles can be drawn with the generic <code>plot</code> function. As with other explanations in the <code>DALEX</code> library, multiple models can be plotted on a single graph. Although for technical reasons quantitative and qualitative variables cannot be shown in a single chart. So if you want to show the importance of quality variables, you need to plot them separately.</p>
<p>Figure below shows an example of a CP profile for continuous variable <code>Age</code> and categorical variable <code>Cardiovascular.Diseases</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>cp_steve.plot(variables<span class="op">=</span><span class="st">"Age"</span>, show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-py_cp_ranger" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/py_cp_ranger.png"></p>
<p></p><figcaption>Figure&nbsp;19: The dot shows the observation under analysis. CP profile shows how the model predictions change for changes in the selected variable. On the left is the CP profile for the continuous variable <code>Age</code>, on the right for the categorical variable <code>Cardiovascular.Diseases</code>. For categorical variables, one can specify how the CP profiles should be drawn by setting the <code>categorical_type</code> argument.</figcaption><p></p>
</figure>
</div>
<p>The <code>plot</code> function can combine multiple models, making it easier to see similarities and differences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>cp_cdc <span class="op">=</span> explainer_cdc.predict_profile(Steve)</span>
<span id="cb36-2"><a href="#cb36-2"></a>cp_dtc <span class="op">=</span> explainer_dtc.predict_profile(Steve)</span>
<span id="cb36-3"><a href="#cb36-3"></a>cp_rfc <span class="op">=</span> explainer_rfc.predict_profile(Steve)</span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a>cp_cdc.plot([cp_rfc, cp_dtc, cp_steve], </span>
<span id="cb36-6"><a href="#cb36-6"></a>        variables<span class="op">=</span><span class="st">"Age"</span>, show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-py_cp_steve" class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/py_cp_steve.png"></p>
<p></p><figcaption>Figure&nbsp;20: CP profiles for Steve, colors code four considered models.</figcaption><p></p>
</figure>
</div>
</section></section>
<section>
<section id="step-10.-interactive-explanatory-model-analysis" class="title-slide slide level1 center">
<h1>Step 10. Interactive explanatory model analysis</h1>

</section>
<section id="six-blind-men-and-the-elephant" class="slide level2">
<h2>Six Blind Men and the Elephant</h2>

<img data-src="figures/elephant.jpeg" class="r-stretch"><p>Source: www.pinkconcussions.com</p>
</section>
<section id="the-grammar-of-interactive-explanatory-model-analysis-12" class="slide level2">
<h2>The grammar of interactive explanatory model analysis 1/2</h2>

<img data-src="figures/iema_01.png" class="r-stretch quarto-figure-center"><p class="caption">Multiple complementary explanations work more effectively than a single explanation</p><p>Source: <a href="https://iema.drwhy.ai/">https://iema.drwhy.ai/</a></p>
</section>
<section id="the-grammar-of-interactive-explanatory-model-analysis-22" class="slide level2">
<h2>The grammar of interactive explanatory model analysis 2/2</h2>

<img data-src="figures/iema_02.png" class="r-stretch quarto-figure-center"><p class="caption">Multiple complementary explanations work more effectively than a single explanation</p><p>Source: <a href="https://iema.drwhy.ai/">https://iema.drwhy.ai/</a></p>
</section>
<section id="arena" class="slide level2">
<h2>Arena</h2>
<p>We have made the model built for Covid data, along with the explanations described in this book, available at webpage. After two months, tens of thousands of people used it. With proper tools the deployment of such a model is not difficult.</p>
<p>To obtain a safe and effective model, it is necessary to perform a detailed Explanatory Model Analysis. However, we often don’t have much time for it. That is why tools that facilitate fast and automated model exploration are so useful.</p>
<p>One of such tools is <code>arena</code>. It is a package that transforms an explainer into an HTML page with javascript based interaction. Such an HTML page is easy to save on a disk or share by email. The webpage has various explanations pre-calculated, so its generation may be time-consuming, but the model exploration is very fast, and the feedback loop is tight.</p>
<p>Generating a <code>arena</code> dashboard for an explainer is easy <a href="https://arena.drwhy.ai/docs/">More info</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>arena <span class="op">=</span> dx.Arena()</span>
<span id="cb37-2"><a href="#cb37-2"></a>arena.push_model(explainer_cdc)</span>
<span id="cb37-3"><a href="#cb37-3"></a>arena.push_model(explainer_dtc)</span>
<span id="cb37-4"><a href="#cb37-4"></a>arena.push_model(explainer_rfc)</span>
<span id="cb37-5"><a href="#cb37-5"></a>arena.push_model(explainer_rfc_tuned)</span>
<span id="cb37-6"><a href="#cb37-6"></a>arena.push_observations(Steve)</span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a>arena.run_server()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section id="your-turn-1" class="title-slide slide level1 center">
<h1>Your turn</h1>
<ul>
<li>In jupiter, reproduce the results from the presentation for the <code>covid</code> data</li>
<li>Apply discussed techniques for the Titanic data (<a href="https://ema.drwhy.ai/dataSetsIntro.html#models-for-rms-titanic-snippets-for-python">see EMA</a>)</li>
</ul>
<pre><code>import dalex as dx
titanic = dx.datasets.load_titanic()
X = titanic.drop(columns='survived')
y = titanic.survived</code></pre>
</section>

<section>
<section id="take-away" class="title-slide slide level1 center">
<h1>Take away</h1>

</section>
<section id="shift-in-our-focus-statistics" class="slide level2">
<h2>Shift in our focus: Statistics</h2>
<ul>
<li>Statistical analysis of data most often assumes a great deal of knowledge about the phenomenon. Understanding the data allows to choose appropriate transformations, representations. Verification is oriented toward hypothesis testing, such as by p-values</li>
</ul>
<p>
</p><center>
<img src="figures/shift1.png" width="100%">
</center>
<p></p>
</section>
<section id="shift-in-our-focus-machine-learning" class="slide level2">
<h2>Shift in our focus: Machine Learning</h2>
<ul>
<li>Machine learning puts a priority on optimizing the model, especially for performance. There is a lot of searching through the space of possible solutions here to find the best one</li>
<li>Knowledge of the phenomenon is no longer so important</li>
</ul>
<p>
</p><center>
<img src="figures/shift2.png" width="100%">
</center>
<p></p>
</section>
<section id="shift-in-our-focus-human-oriented-ml" class="slide level2">
<h2>Shift in our focus: Human Oriented ML?</h2>
<ul>
<li>What’s next. If model building can be easily and quickly automated, in-depth model verification will become more important</li>
<li>This is where models are created seamlessly according to the needs of the user, and the user can focus on decisions supported by the models</li>
</ul>
<p>
</p><center>
<img src="figures/shift3.png" width="100%">
</center>
<p></p>
</section>
<section id="take-home-message" class="slide level2">
<h2>Take-home message</h2>
<p><strong>Why interpretability is important?</strong></p>
<ul>
<li>Higher trust -&gt; <strong>higher adoption of ML solutions</strong> that will support decision making process</li>
<li>May be <strong>required by auditors, regulators</strong>, law</li>
<li>New tool for model exploration -&gt; to <strong>gain new insights</strong> about the data/nature of some phenomenon</li>
<li>Gate keeping role, human can <strong>control and/or block wrong decisions</strong> when knowing key reasons behind these decisions</li>
<li><strong>Debugg/improve data or models</strong>, identify wrong behavior and help to plan actions to fix it</li>
<li><strong>Deeper diagnostic of models</strong>, validation against some domain knowledge, expectations or other values (like human rights -&gt; fairness)</li>
</ul>
</section>
<section class="slide level2">

<p><img data-src="figures/rml_comic_12.png"></p>
<p><img src="figures/XAI.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Explanation is a process – EuADS Summer School – 08/06/2023</p>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="EuADS_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="EuADS_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="EuADS_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="EuADS_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="EuADS_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="EuADS_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="EuADS_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="EuADS_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="EuADS_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="EuADS_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="EuADS_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>